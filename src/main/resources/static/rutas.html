<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rutas de la Ciudad</title>
    <link rel="stylesheet" href="rutas.css">
</head>
<body id="top">
    <header>
        <a href="index.html">
            <img src="logoCiudadInteligente.png" alt="Logo Ciudad Inteligente" class="logo-header">
        </a>
        <nav>
            <a href="index.html">Barrios de la ciudad</a>
            <a href="rutas.html">Rutas</a>

            <div class="submenu">
                <a href="#">Eventos públicos </a>
                <div class="submenu-content">
                    <a href="crearEvento.html">Crear evento</a>
                    <a href="verEventos.html">Ver eventos</a>
                </div>
            </div>

            <div class="submenu">
                <a href="#">Presupuesto </a>
                <div class="submenu-content">
                    <a href="cargarPresupuesto.html">Cargar presupuesto</a>
                    <a href="gestionarPresupuesto.html">Gestionar presupuesto</a>
                </div>
            </div>

            <a href="personal.html">Personal</a>
            <a href="puntoDeInteres.html">Puntos de interés</a>
        </nav>
    </header>

    <main>
        <h1>Buscar la ruta mínima entre barrios</h1>
        <form id="ruta-form">
            <label for="origen">Barrio de origen:</label>
            <select id="origen" name="origen" required></select>

            <label for="destino">Barrio de destino:</label>
            <select id="destino" name="destino" required></select>

            <button type="submit">Buscar ruta mínima</button>
        </form>

        <div id="resultado"></div>
    </main>

    <footer>
        <img src="logoCiudadInteligente.png" alt="Logo Ciudad Inteligente" class="logo-footer">
        <p>© 2025 Ciudad Digital. Todos los derechos reservados.</p>
        <p><a href="contacto.html">Contacto</a> | Términos y condiciones</p>
    </footer>

    <a href="#top" class="back-to-top" aria-label="Volver arriba" title="Volver arriba">↑</a>



    <script>
        // ==========================
        // Función para cargar barrios en los selects
        // ==========================
        async function cargarBarrios() {
            try {
                const res = await fetch('http://localhost:8080/api/barrios');
                if (!res.ok) throw new Error("No se pudieron cargar los barrios");
                const barrios = await res.json();

                const origenSelect = document.getElementById("origen");
                const destinoSelect = document.getElementById("destino");

                barrios.forEach(barrio => {
                    const optOrigen = document.createElement("option");
                    optOrigen.value = barrio;
                    optOrigen.textContent = barrio;
                    origenSelect.appendChild(optOrigen);

                    const optDestino = document.createElement("option");
                    optDestino.value = barrio;
                    optDestino.textContent = barrio;
                    destinoSelect.appendChild(optDestino);
                });
            } catch (err) {
                console.error("Error cargando barrios:", err);
                alert("No se pudieron cargar los barrios desde el servidor.");
            }
        }

        // ==========================
        // Manejar submit del formulario
        // ==========================
        async function calcularRuta(e) {
            e.preventDefault();

            const origen = document.getElementById("origen").value;
            const destino = document.getElementById("destino").value;

            if (!origen || !destino) {
                alert("Debe seleccionar un barrio de origen y uno de destino");
                return;
            }

            try {
                const res = await fetch('http://localhost:8080/api/ruta', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ origen, destino })
                });

                if (!res.ok) throw new Error("Error al calcular la ruta");

                const data = await res.json();
                const resultadoDiv = document.getElementById("resultado");

                if (data.camino && data.costo !== undefined) {
                    resultadoDiv.innerHTML = `
                        <p><strong>Camino:</strong> ${data.camino.join(" → ")}</p>
                        <p><strong>Costo:</strong> ${data.costo}</p>
                    `;
                } else {
                    resultadoDiv.textContent = "No se pudo calcular la ruta.";
                }

            } catch (err) {
                console.error(err);
                alert("Ocurrió un error al calcular la ruta.");
            }
        }

        // ==========================
        // Inicializar la página
        // ==========================
        document.addEventListener("DOMContentLoaded", cargarBarrios);
        document.getElementById("ruta-form").addEventListener("submit", calcularRuta);
    </script>

    
</body>
</html>
