<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puntos de Interés</title>
    <link rel="stylesheet" href="index.css">
</head>
<body id="top">
    <header>
        <a href="index.html">
            <img src="logoCiudadInteligente.png" alt="Logo Ciudad Inteligente" class="logo-header">
        </a>
        <nav>
            <a href="rutas.html">Rutas</a>

            <div class="submenu">
                <a href="#">Eventos públicos</a>
                <div class="submenu-content">
                    <a href="crearEvento.html">Crear evento</a>
                    <a href="verEventos.html">Ver eventos</a>
                </div>
            </div>


            <a href="personal.html">Personal</a>
            <a href="puntoDeInteres.html">Puntos de interés</a>
        </nav>
    </header>

    <main>
        <h1>Puntos de Interés de la Ciudad</h1>

        <section id="seleccion-parada">
            <label for="paradaSelect">Seleccioná una o varias paradas:</label>
            <select id="paradaSelect" multiple size="10">
                <option value="">-- Elegí una o varias paradas --</option>
            </select>
            <div class="botones">
                <button id="btnSeleccionar">Seleccionar</button>
                <button id="btnCalcularRuta">Calcular ruta</button>
            </div>
        </section>

        <div id="puntos-container"></div>
    </main>

    <footer>
        <img src="logoCiudadInteligente.png" alt="Logo Ciudad Inteligente" class="logo-footer">
        <p>© 2025 Ciudad Digital. Todos los derechos reservados</p>
        <p><a href="contacto.html">Contacto</a> | Términos y condiciones</p>
    </footer>

    <a href="#top" class="back-to-top" aria-label="Volver arriba" title="Volver arriba">↑</a>

    <!-- Script directo (ya probado) -->
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const paradaSelect = document.getElementById("paradaSelect");
            const btnSeleccionar = document.getElementById("btnSeleccionar");
            const btnCalcularRuta = document.getElementById("btnCalcularRuta");
            const puntosContainer = document.getElementById("puntos-container");

            async function cargarParadas() {
                try {
                    const res = await fetch("http://localhost:8080/paradas/listar");
                    if (!res.ok) throw new Error("Error al cargar paradas");
                    const paradas = await res.json();

                    paradaSelect.innerHTML = `<option value="">-- Elegí una o varias paradas --</option>`;

                    paradas.forEach(p => {
                        const opt = document.createElement("option");
                        opt.value = p.nombre;
                        opt.textContent = p.nombre;
                        paradaSelect.appendChild(opt);
                    });

                    console.log("Paradas cargadas:", paradas);
                } catch (err) {
                    console.error("Error cargando paradas:", err);
                    alert("No se pudieron cargar las paradas.");
                }
            }

            btnSeleccionar.addEventListener("click", () => {
                const seleccionadas = Array.from(paradaSelect.selectedOptions).map(opt => opt.value);

                if (seleccionadas.length === 0) {
                    alert("Seleccioná al menos una parada.");
                    return;
                }

                puntosContainer.innerHTML = `
                    <h3>Paradas seleccionadas:</h3>
                    <ul>
                        ${seleccionadas.map(p => `<li>${p}</li>`).join("")}
                    </ul>
                `;
            });

            btnCalcularRuta.addEventListener("click", async () => {
    const seleccionadas = Array.from(paradaSelect.selectedOptions).map(opt => opt.value);

    if (seleccionadas.length < 2) {
        alert("Seleccioná al menos dos paradas para calcular el orden óptimo.");
        return;
    }

    try {
        const res = await fetch("http://localhost:8080/paradas/orden-optimo", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(seleccionadas)
        });

        const data = await res.json();

        if (data.error) {
            alert(data.error);
            return;
        }

        if (data.orden && data.orden.length > 0) {
            puntosContainer.innerHTML = `
                <h3>Orden óptimo de recorrido:</h3>
                <p>${data.orden.join(" → ")}</p>
            `;
        } else {
            puntosContainer.innerHTML = "<p>No se pudo determinar un orden óptimo.</p>";
        }

    } catch (err) {
        console.error("Error calculando orden óptimo:", err);
        alert("Ocurrió un error al calcular el orden óptimo.");
    }
});


            await cargarParadas();
        });
    </script>
</body>
</html>
